---
title: "mcb_graph"
output: html_document
---

```{r}
library(phyloseq)
library(phylox)
library(ggplot2)
library(ggmetaplots)
```

```{r}
# Avoid using absolute path in the future. Because if I run this in my computer,
# it won't be able to find the path. We had this conversation before.
# Use relative path:
# load("../../data/mcb.rda")
load("~/Documents/Zivkovic_Lab/egg_study/data/mcb.rda")
```

```{r}
ps = as_phyloseq(mcb)
```

```{r}
sum_ps = summarizeFromPhyloseq(ps)
ps_prop = transform_sample_counts(ps, function(x) x/sum(x))
sum_ps_prop = summarizeFromPhyloseq(ps_prop)
```

### 1. composition of microbiome differ in groups at different phylogenic level (bar)
(egg: pre / post, eggwhite: pre / post)

```{r}
plot_bar(sum_ps_prop, level = "Phylum", by = c("Timepoint", "Treatment"))
```

### 2. otu diversity (alpha) boxplot diversity difference in groups(trt)

```{r}
plot_richness(ps, x = "Timepoint", measures = "Shannon") +
    geom_boxplot(lwd = 0.7) +
    geom_line(aes(group = Subject, color = Subject)) +
    geom_point(aes(color = Subject)) +
    facet_grid(cols = vars(Treatment)) 
```
### 3. otu difference among groups (boxplot by phylogenic level and something else)
```{r}
## Avoid haveing your code longer than 80 characters per line. It's OK if it is
## a little too long, but not like this. 
## So follow this coding style in the future.
# df = data.frame(OTU = as.numeric(otu_table(ps_prop)[1,]), 
#     SubjectID = sample_data(ps_prop)$SubjectID, 
#     Treatment = sample_data(ps_prop)$Treatment, 
#     Timepoint = sample_data(ps_prop)$Timepoint
# )
df = data.frame(OTU = as.numeric(otu_table(ps_prop)[1,]), SubjectID = sample_data(ps_prop)$SubjectID, Treatment = sample_data(ps_prop)$Treatment, Timepoint = sample_data(ps_prop)$Timepoint)

# In ggplot, inside the aes(), you don't need to specify the data.frame.
# Wierd thing could happen if you do that. So this is just fine:
# p = ggplot(df, aes(Timepoint, OTU))
p <- ggplot(df, aes(df$Timepoint, df$OTU))
p + geom_boxplot() +
    facet_grid(cols = vars(df$Treatment))
# Add points on the top of the boxes, and draw lines to connect up the two points
# that belong to the same person, just like what we did above
```

4. beta diversity (tree)
diversity in same sample, group


